

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Complex Stellar Histories &mdash; hoki v1.7.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Age Wizard" href="AgeWizard.html" />
    <link rel="prev" title="Colour Magnitude Diagrams" href="CMDs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #FFA428" >
          

          
            <a href="index.html" class="icon icon-home"> hoki
          

          
            
            <img src="_static/hoki_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">What is Hoki?</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html"><strong>Citing Us</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Model Outputs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="Transient_rates.html">Transient rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="HR_diagrams.html">HR diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spectra.html">Spectra</a></li>
</ul>
<p class="caption"><span class="caption-text">SED Fitting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sedfitting.html">SED fiting with BPASS and hoki</a></li>
<li class="toctree-l1"><a class="reference internal" href="Voronoi_binning_of_SED_data.html">Vornoi Binning and retrieveing SEDs of the binned data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fitting_the_region_around_the_transient.html">SED fitting of a transient neighbourhood</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fitting_SEDs_of_a_data_cube_with_BPASS-hoki-ppxf.html">SED fitting of a data cube</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc Recipes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="CMDs.html">Colour Magnitude Diagrams</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Complex Stellar Histories</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Initial-Imports">Initial Imports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#In-this-tutorial-you-will-learn:">In this tutorial you will learn:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Stellar-Formation-History">Stellar Formation History</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#SFH-class">SFH class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Custom-SFH">Custom SFH</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Event-Rate-calculations">Event Rate calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Initialisation-of-CSPEventRate">Initialisation of <code class="docutils literal notranslate"><span class="pre">CSPEventRate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Calculating-event-rates">Calculating event rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Defining-an-SFH-and-metallicity-evolution">Defining an SFH and metallicity evolution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#CSPEventRate.at_time"><code class="docutils literal notranslate"><span class="pre">CSPEventRate.at_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#CSPEventRate.over_time"><code class="docutils literal notranslate"><span class="pre">CSPEventRate.over_time</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Grid-Calculations:-EventRates">Grid Calculations: EventRates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#EventRates">EventRates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="AgeWizard.html">Age Wizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModelDataCompiler.html">Model Data Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModelSearch.html">Complex Model Search</a></li>
</ul>
<p class="caption"><span class="caption-text">Full Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="manual.html"><strong>Dependencies</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#module-hoki.cmd"><strong>hoki.cmd</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#hoki-constants"><strong>hoki.constants</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#module-hoki.eve"><strong>hoki.eve</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#module-hoki.load"><strong>hoki.load</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#module-hoki.hrdiagrams"><strong>hoki.hrdiagrams</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#module-hoki.age.wizard"><strong>hoki.age</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#module-hoki.csp.csp"><strong>hoki.csp</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html#hoki-sedfitting"><strong>hoki.sedfitting</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">GITHUB LINKS</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/HeloiseS/hoki">Hoki</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/HeloiseS/hoki_tutorials">Notebooks</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hoki</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Complex Stellar Histories</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/ComplexStellarPopulations.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Complex-Stellar-Histories">
<h1>Complex Stellar Histories<a class="headerlink" href="#Complex-Stellar-Histories" title="Permalink to this headline">¶</a></h1>
<p>Download all the Jupyter notebooks from: <a class="reference external" href="https://github.com/HeloiseS/hoki_tutorials">https://github.com/HeloiseS/hoki_tutorials</a></p>
<div class="section" id="Initial-Imports">
<h2>Initial Imports<a class="headerlink" href="#Initial-Imports" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">hoki.constants</span> <span class="kn">import</span> <span class="o">*</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;tuto.mplstyle&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="In-this-tutorial-you-will-learn:">
<h3>In this tutorial you will learn:<a class="headerlink" href="#In-this-tutorial-you-will-learn:" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The Stellar Formation History class, <code class="docutils literal notranslate"><span class="pre">SFH</span></code>, and its attributes</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">CSPEventRate</span></code> to generate event rates for complex stellar populations</p></li>
</ul>
<p>BPASS contains simple stellar populations (all co-eval) with a total of <span class="math notranslate nohighlight">\(10^{6}\)</span> M<span class="math notranslate nohighlight">\(_\odot\)</span> at for a given metallicity and imf. While this is a valid assumption for some populations, others can have a more complex stellar formation history and metallicity evolution. Therefore, we introduce the <code class="docutils literal notranslate"><span class="pre">hoki.csp</span></code> package. This package allows for the creation of more complex stellar populations using the BPASS populations.</p>
</div>
</div>
<div class="section" id="Stellar-Formation-History">
<h2>Stellar Formation History<a class="headerlink" href="#Stellar-Formation-History" title="Permalink to this headline">¶</a></h2>
<p>Many of the standard stellar formation histories (SFH) are included in <code class="docutils literal notranslate"><span class="pre">hoki.csp.sfh</span></code> package. These SFH are generated using the <code class="docutils literal notranslate"><span class="pre">SFH</span></code> class, which always takes a time array and a string as inputs. The time array determines the sampling of the time domain, while the string determines the type of SFH to use. Each available formation history has a unique string identifier. A list of all available formation histories and their identifiers can be found in the hoki documentation. #[link]!!
[<a class="reference external" href="https://heloises.github.io/hoki/manual.html#module-hoki.csp.sfh">https://heloises.github.io/hoki/manual.html#module-hoki.csp.sfh</a>]</p>
<p>If you wish to us a built-in SFH, you will also needs to parse a dictionary containing the necessary parameters and their values. A comprehensive list of these can also be found in the documentation.</p>
<p>In this example we load in three of the built-in SFH:</p>
<ul class="simple">
<li><p>Burst</p></li>
<li><p>Constant</p></li>
<li><p>Log Normal</p></li>
</ul>
<div class="section" id="SFH-class">
<h3>SFH class<a class="headerlink" href="#SFH-class" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">hoki.csp.sfh</span> <span class="kn">import</span> <span class="n">SFH</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Creating 100 time points from age 0 to the current age of the Universe</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">HOKI_NOW</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Instanciating a Burst SFH</span>
<span class="n">burst</span> <span class="o">=</span> <span class="n">SFH</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;T0&quot;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>

<span class="c1"># Instanciating a constant SFH</span>
<span class="n">constant</span> <span class="o">=</span> <span class="n">SFH</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;constant&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Instanciating a log_normal SFH</span>
<span class="n">log_normal</span> <span class="o">=</span> <span class="n">SFH</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="s1">&#39;ln&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;constant&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s2">&quot;T0&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/mbri637/Documents/code/hoki/hoki/csp/sfh.py:166: RuntimeWarning: divide by zero encountered in log
  - ((np.log(self.time_axis/1e9) - self.params[&#39;T0&#39;]) ** 2) / (2 * self.params[&#39;tau&#39;] ** 2)))
</pre></div></div>
</div>
<p>Now that we have create <code class="docutils literal notranslate"><span class="pre">SFH</span></code> instances, we can take a look at their shapes by plotting them. Like other <code class="docutils literal notranslate"><span class="pre">hoki</span></code> objects (<code class="docutils literal notranslate"><span class="pre">HRDiagram</span></code>, <code class="docutils literal notranslate"><span class="pre">CMD</span></code>), the <code class="docutils literal notranslate"><span class="pre">SFH</span></code> class comes with its own plotting method: <code class="docutils literal notranslate"><span class="pre">SFH.plot()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">burst</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;burst&quot;</span><span class="p">)</span>
<span class="n">constant</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>
<span class="n">log_normal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;log normal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Built-in Stellar Formation Histories&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Stellar Formation History [M/yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lookback time [yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">13.8e9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/mbri637/Documents/code/hoki/hoki/csp/sfh.py:170: MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.
  sfh_plot = plt.subplot(loc)
/Users/mbri637/Documents/code/hoki/hoki/csp/sfh.py:170: MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.
  sfh_plot = plt.subplot(loc)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ComplexStellarPopulations_6_1.png" src="_images/ComplexStellarPopulations_6_1.png" />
</div>
</div>
</div>
<div class="section" id="Custom-SFH">
<h3>Custom SFH<a class="headerlink" href="#Custom-SFH" title="Permalink to this headline">¶</a></h3>
<p>Besides the built-in stellar formation histories, it’s possible to make your own stellar formation history.</p>
<p>The identifier <code class="docutils literal notranslate"><span class="pre">&quot;custom&quot;</span></code> allows for the input of a value array, <code class="docutils literal notranslate"><span class="pre">sfh_arr</span></code>, which contains the star formation rates associated with each time bin parsed in <code class="docutils literal notranslate"><span class="pre">time_axis</span></code>(that means it should be the same length). In this case, the parameter dictionary is not called and you don’t need to provide it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Custom star formation history values</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time_axis</span><span class="p">))</span>

<span class="c1"># Instanciation of our custom SFH object</span>
<span class="n">custom</span> <span class="o">=</span> <span class="n">SFH</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="n">sfh_arr</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s plot it to see what it looks like :)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">burst</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">custom</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Stellar Formation Histories&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Stellar Formation History [M/yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lookback time [yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">13.8e9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/mbri637/Documents/code/hoki/hoki/csp/sfh.py:170: MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.
  sfh_plot = plt.subplot(loc)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ComplexStellarPopulations_10_1.png" src="_images/ComplexStellarPopulations_10_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Event-Rate-calculations">
<h2>Event Rate calculations<a class="headerlink" href="#Event-Rate-calculations" title="Permalink to this headline">¶</a></h2>
<p>By combining the BPASS populations with the <strong>complex SFH</strong>, it is possible to <strong>generate transient rates</strong> for the new populations. <code class="docutils literal notranslate"><span class="pre">hoki</span></code> provides the subpackage <code class="docutils literal notranslate"><span class="pre">hoki.csp.eventrate</span></code> for this purpose.</p>
<div class="section" id="Initialisation-of-CSPEventRate">
<h3>Initialisation of <code class="docutils literal notranslate"><span class="pre">CSPEventRate</span></code><a class="headerlink" href="#Initialisation-of-CSPEventRate" title="Permalink to this headline">¶</a></h3>
<p>When initialising the <code class="docutils literal notranslate"><span class="pre">CSPEventRate</span></code> class, it loads and normalises the BPASS supernova files for all metallicities. Stored in a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>, they are accessible using <code class="docutils literal notranslate"><span class="pre">CSPEventRate.bpass_rates</span></code>. The following event types are available from BPASS: <code class="docutils literal notranslate"><span class="pre">[Ia,</span> <span class="pre">IIP,</span> <span class="pre">II,</span> <span class="pre">Ib,</span> <span class="pre">Ic,</span> <span class="pre">LGRB,</span> <span class="pre">PISNe,</span> <span class="pre">low_mass]</span></code></p>
<p>BPASS contains a selection of initial mass functions. To support all of them, the <code class="docutils literal notranslate"><span class="pre">CSPEventRate</span></code> class requires an imf identifier. These can be found in <a class="reference external" href="https://heloises.github.io/hoki/manual.html#module-hoki.csp.eventrate">the class’s documentation</a>.</p>
<p><strong>! ! ! ! WARNING ! ! ! !</strong></p>
<p>If you want to run the following cells you will to change the <code class="docutils literal notranslate"><span class="pre">path_to_files</span></code> to your local folder containing the BPASS <code class="docutils literal notranslate"><span class="pre">supernova</span></code> files. If you downloaded them straight off the <a class="reference external" href="https://drive.google.com/drive/u/1/folders/1GfMSO2ZiIabHSQRh7zTA3I51DPGbmtAB">google drive</a>, it’ll probably have a name like <code class="docutils literal notranslate"><span class="pre">bpass_v2.2.1_imf135_300</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">hoki.csp.eventrate</span> <span class="kn">import</span> <span class="n">CSPEventRate</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">path_to_files</span> <span class="o">=</span> <span class="s2">&quot;../BPASS_hoki_dev/bpass_v2.2.1_imf135_300&quot;</span>
<span class="n">imf_identifier</span> <span class="o">=</span> <span class="s2">&quot;imf135_300&quot;</span>
<span class="n">ER_CSP</span> <span class="o">=</span> <span class="n">CSPEventRate</span><span class="p">(</span><span class="n">path_to_files</span><span class="p">,</span> <span class="n">imf_identifier</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Calculating-event-rates">
<h3>Calculating event rates<a class="headerlink" href="#Calculating-event-rates" title="Permalink to this headline">¶</a></h3>
<p>After initialising the class, the event rates for complex stellar populations can be calculated using the following functions: - <code class="docutils literal notranslate"><span class="pre">CSPEventRate.at_time</span></code> - <code class="docutils literal notranslate"><span class="pre">CSPEventRate.over_time</span></code></p>
<p>Both take the same 3 parameters: - Description of the SFH - Descriptoin of the Metallicity Evolution - An array containing the event types to be calculated</p>
</div>
<div class="section" id="Defining-an-SFH-and-metallicity-evolution">
<h3>Defining an SFH and metallicity evolution<a class="headerlink" href="#Defining-an-SFH-and-metallicity-evolution" title="Permalink to this headline">¶</a></h3>
<p>We define a constant metallicity and stellar formation rate. The methods in <code class="docutils literal notranslate"><span class="pre">CSPEventRate</span></code> require the SFH and metallicity evolution to be provided as python callables (i.e something that can be called, i.e something that require brackets to work: <code class="docutils literal notranslate"><span class="pre">myfunction()</span></code>). It is also possible to use a <code class="docutils literal notranslate"><span class="pre">SFH</span></code> object as an input for the SFH evolution – it was designed to work with these :)</p>
<p>Here, we define two python functions describing the SFH and metallicity evolution. These have to be set to 0 if the age is older than the universe. We define the SFR to be constant at 1 and the metallicity to be constant at solar.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">SFR_evolution</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">HOKI_NOW</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">Z_evolution</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.0020</span>
</pre></div>
</div>
</div>
<div class="section" id="CSPEventRate.at_time">
<h4><code class="docutils literal notranslate"><span class="pre">CSPEventRate.at_time</span></code><a class="headerlink" href="#CSPEventRate.at_time" title="Permalink to this headline">¶</a></h4>
<p><em>Input</em></p>
<p>In addition to the 3 standard input parameters, you need to provide <strong>the time at which</strong> you want the event rates calculated.</p>
<p><strong>You can provide more than one SFH and metallicity histories, as described below</strong></p>
<p>As an optional input, the <strong>sampling rate</strong> of the SFH and metallicity evolution can be given. The default sampling is set to 1000. This makes the calculation accurate and fast. If a negative number is given, the BPASS bins are used.</p>
<p><em>Output</em></p>
<p>The output an array, where each element corresponds to an SHF/metallicity history pair.</p>
<p>Each complex stellar population contains an array with the type of transient event as an identifier.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>output[nr csp][event type]
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># calculate rate at LB = 0 Gyr</span>
<span class="n">er_zero</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">at_time</span><span class="p">(</span><span class="n">SFR_evolution</span><span class="p">,</span> <span class="n">Z_evolution</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Event Rate now:&quot;</span><span class="p">,</span> <span class="n">er_zero</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">])</span>

<span class="c1"># calculate rate at LB = 10 Gyr</span>
<span class="n">er_ten</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">at_time</span><span class="p">(</span><span class="n">SFR_evolution</span><span class="p">,</span> <span class="n">Z_evolution</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mf">10e9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Event rate at 10 Gyr lookback time:&quot;</span><span class="p">,</span> <span class="n">er_ten</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">])</span>

<span class="c1"># High sampling event rate</span>
<span class="n">er_high_sampling</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">at_time</span><span class="p">(</span><span class="n">SFR_evolution</span><span class="p">,</span> <span class="n">Z_evolution</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mf">10e9</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Event rate 1000 samples:&quot;</span><span class="p">,</span> <span class="n">er_high_sampling</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Event Rate now: 0.0015103559493986228
Event rate at 10 Gyr lookback time: 0.0013245082839476612
Event rate 1000 samples: 0.0013273604259601117
</pre></div></div>
</div>
<p>It is also possible to input several SFH and metallicity evolutions in a single function call by inputting two lists of equal length. Each SFH will be associated with a metallicity evolution at the same index.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">er</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">at_time</span><span class="p">([</span><span class="n">SFR_evolution</span><span class="p">,</span> <span class="n">SFR_evolution</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">Z_evolution</span><span class="p">,</span> <span class="n">Z_evolution</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">,</span> <span class="s2">&quot;II&quot;</span><span class="p">],</span>
                    <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First history, Ia rates:&quot;</span><span class="p">,</span> <span class="n">er</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second history, II rates:&quot;</span><span class="p">,</span> <span class="n">er</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;II&quot;</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
First history, Ia rates: 0.0015103559493986228
Second history, II rates: 0.0035807774002009902
</pre></div></div>
</div>
<p>Of course, it is also possible to provide a <code class="docutils literal notranslate"><span class="pre">SFH</span></code> object from <code class="docutils literal notranslate"><span class="pre">hoki</span></code> as an input.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">er</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">at_time</span><span class="p">(</span><span class="n">constant</span><span class="p">,</span>
                    <span class="n">Z_evolution</span><span class="p">,</span>
                    <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">,</span> <span class="s2">&quot;II&quot;</span><span class="p">],</span>
                    <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ia rates:&quot;</span><span class="p">,</span> <span class="n">er</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;II rates:&quot;</span><span class="p">,</span> <span class="n">er</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;II&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ia rates: 0.0015103573172394677
II rates: 0.0035807774002009902
</pre></div></div>
</div>
</div>
<div class="section" id="CSPEventRate.over_time">
<h4><code class="docutils literal notranslate"><span class="pre">CSPEventRate.over_time</span></code><a class="headerlink" href="#CSPEventRate.over_time" title="Permalink to this headline">¶</a></h4>
<p>This method splits the lookback time up into a chosen number of bins and calculates the event rate over the whole lookback time at once. Because the event rates over the full history of the universe is calculated, this method is more computationally intensive than <code class="docutils literal notranslate"><span class="pre">CSPEventRate.at_time</span></code>.</p>
<p>In addition to the 3 standard input parameters, this method requires you to provide a number of bins that determines the number of bins the complete lookback time is split into.</p>
<p>It has an optional argument, <code class="docutils literal notranslate"><span class="pre">return_time_edges</span></code>, that will return the time edges of the binning (in addition to the standard outputs).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">er_all</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">over_time</span><span class="p">([</span><span class="n">SFR_evolution</span><span class="p">],</span> <span class="p">[</span><span class="n">Z_evolution</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mi">100</span><span class="p">,</span> <span class="n">return_time_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">er_all</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="n">where</span><span class="o">=</span><span class="s2">&quot;pre&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lookback Time [yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Type Ia Event Rate [#events/yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">er_zero</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">10e9</span><span class="p">,</span> <span class="n">er_ten</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ComplexStellarPopulations_25_0.png" src="_images/ComplexStellarPopulations_25_0.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Grid-Calculations:-EventRates">
<h2>Grid Calculations: EventRates<a class="headerlink" href="#Grid-Calculations:-EventRates" title="Permalink to this headline">¶</a></h2>
<p>Sometimes using a Python callable isn’t the right way to describe the stellar formation history, such as when working with simulations with stored data points. Therefore, it is also possible to provide a 2D grid (<code class="docutils literal notranslate"><span class="pre">nr_sfh</span></code>x<code class="docutils literal notranslate"><span class="pre">13</span></code>x<code class="docutils literal notranslate"><span class="pre">N</span></code>) as an SFH input. This matrix splits up each SFH into BPASS metallicity bins (<code class="docutils literal notranslate"><span class="pre">13</span></code>) per time point (<code class="docutils literal notranslate"><span class="pre">N</span></code>). The <code class="docutils literal notranslate"><span class="pre">nr_sfh</span></code> is always necesarry even when a single SFH grid is given.</p>
<p>The associated functions are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CSPEventRate.grid_at_time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CSPEventRate.grid_over_time</span></code></p></li>
</ul>
<p>Instead of taking a SFH and metallicity evolution both are separated to allow for material being created with different metallicities at the same time. Instead they need a <code class="docutils literal notranslate"><span class="pre">time_points</span></code> parameter describing what the lookback times of the 2D SFH are.</p>
<p><strong>Note</strong></p>
<p>Depending on your operating system, a “<code class="docutils literal notranslate"><span class="pre">NumbaWarning</span></code> about TBB threading” might appear when using the grid functions. This can be safely ignored.</p>
<div class="section" id="EventRates">
<h3>EventRates<a class="headerlink" href="#EventRates" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># setup example 2D grid</span>
<span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">HOKI_NOW</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">SFH_2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time_points</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">bpass_Z_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Z_evolution</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">BPASS_NUM_METALLICITIES</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time_points</span><span class="p">])</span>
<span class="n">SFH_2D</span><span class="p">[</span><span class="n">bpass_Z_index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">SFR_evolution</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time_points</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Because our <code class="docutils literal notranslate"><span class="pre">SFH_2D</span></code> is only a 13x101 matrix we transform it into a 1x13x101 matrix for it to be used as input of our <code class="docutils literal notranslate"><span class="pre">*.grid_at_time</span></code> and <code class="docutils literal notranslate"><span class="pre">*.grid_over_time</span></code> functions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Transform into (1x13xtime_points)</span>
<span class="n">SFH_2D</span> <span class="o">=</span> <span class="n">SFH_2D</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time_points</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Event rate at lookback time t = 0</span>
<span class="n">er_at_time_per_metallicity1</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">grid_at_time</span><span class="p">(</span><span class="n">SFH_2D</span><span class="p">,</span> <span class="n">time_points</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Event rate at lookback time t = 10 Gyr</span>
<span class="n">er_at_time_per_metallicity2</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">grid_at_time</span><span class="p">(</span><span class="n">SFH_2D</span><span class="p">,</span> <span class="n">time_points</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mf">10e9</span><span class="p">)</span>

<span class="c1"># The event rate over lookback time</span>
<span class="n">er_over_time_per_metallicity</span><span class="p">,</span> <span class="n">time_edges</span> <span class="o">=</span> <span class="n">ER_CSP</span><span class="o">.</span><span class="n">grid_over_time</span><span class="p">(</span><span class="n">SFH_2D</span><span class="p">,</span> <span class="n">time_points</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Ia&quot;</span><span class="p">],</span> <span class="mi">100</span><span class="p">,</span> <span class="n">return_time_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 |----------------------------------------------------------------------------------------------------| 0.00%
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Sum select the first SFH and sum over the metallicity bins</span>
<span class="n">er_over_time</span> <span class="o">=</span> <span class="n">er_over_time_per_metallicity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">er_at_time1</span> <span class="o">=</span> <span class="n">er_at_time_per_metallicity1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">er_at_time2</span> <span class="o">=</span> <span class="n">er_at_time_per_metallicity2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">time_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">er_over_time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">er_at_time1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ia&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">10e9</span><span class="p">,</span> <span class="n">er_at_time2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ia&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Type Ia events&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lookback Time [yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Type Ia Event Rate [#events/yr]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ComplexStellarPopulations_31_0.png" src="_images/ComplexStellarPopulations_31_0.png" />
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="AgeWizard.html" class="btn btn-neutral float-right" title="Age Wizard" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="CMDs.html" class="btn btn-neutral float-left" title="Colour Magnitude Diagrams" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, heloise stevance.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>